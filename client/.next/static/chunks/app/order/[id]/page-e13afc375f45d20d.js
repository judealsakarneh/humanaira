(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[6137],{63:(e,s,t)=>{"use strict";var a=t(7260);t.o(a,"useParams")&&t.d(s,{useParams:function(){return a.useParams}}),t.o(a,"useRouter")&&t.d(s,{useRouter:function(){return a.useRouter}})},1916:(e,s,t)=>{Promise.resolve().then(t.bind(t,4862))},4862:(e,s,t)=>{"use strict";t.r(s),t.d(s,{default:()=>i});var a=t(5155),r=t(2115),n=t(63),o=t(2663);function i(){var e;let{id:s}=(0,n.useParams)(),[t,i]=(0,r.useState)(null),[l,c]=(0,r.useState)(""),[u,d]=(0,r.useState)({rating:5,comment:""}),[m,g]=(0,r.useState)(!1),[h,x]=(0,r.useState)([]),[f,p]=(0,r.useState)(""),[b,v]=(0,r.useState)(null),y=(0,r.useRef)(null);(0,r.useEffect)(()=>{(async()=>{var e,t,a;let r=await fetch("/api/order/".concat(s)),n=await r.json();if(i(n.order),v((null==(e=n.order)?void 0:e.buyer_id)||(null==(t=n.order)?void 0:t.seller_id)||null),(null==(a=n.order)?void 0:a.status)==="COMPLETED"){let e=await fetch("/api/reviews?order_id=".concat(s));g(!!(await e.json()).review)}})()},[s]),(0,r.useEffect)(()=>{let e,t=async()=>{let e=await fetch("/api/messages?order_id=".concat(s));x((await e.json()).messages||[]),setTimeout(()=>{var e;null==(e=y.current)||e.scrollTo({top:y.current.scrollHeight,behavior:"smooth"})},100)};return t(),e=setInterval(t,3e3),()=>clearInterval(e)},[s]);let j=async e=>{e.preventDefault(),f.trim()&&((await fetch("/api/messages",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({order_id:s,content:f})})).ok?o.Ay.success("Message sent!"):o.Ay.error("Failed to send message"),p(""))},N=async e=>{let t=await fetch("/api/order/".concat(s),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({action:e,note:l})}),a=await t.json();t.ok?(i(a.order),o.Ay.success("Order updated!")):o.Ay.error(a.error||"Error")},w=async()=>{(await fetch("/api/reviews",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({order_id:s,...u})})).ok?(o.Ay.success("Review submitted!"),g(!0)):o.Ay.error("Error submitting review")};return t?(0,a.jsxs)("main",{className:"max-w-3xl mx-auto px-6 py-10",children:[(0,a.jsx)("h1",{className:"text-2xl font-semibold mb-3",children:null==(e=t.gig)?void 0:e.title}),(0,a.jsxs)("div",{className:"text-sm text-gray-600 mb-4",children:["Status: ",t.status]}),(0,a.jsx)("textarea",{className:"border w-full p-3 focus:outline-none focus:ring focus:ring-blue-300",rows:4,placeholder:"Message or delivery note",value:l,onChange:e=>c(e.target.value)}),(0,a.jsxs)("div",{className:"flex gap-3 mt-3",children:["IN_PROGRESS"===t.status&&(0,a.jsx)("button",{onClick:()=>N("DELIVER"),className:"px-4 py-2 rounded bg-black text-white hover:bg-gray-800 transition focus:outline-none focus:ring focus:ring-blue-300",children:"Deliver"}),"DELIVERED"===t.status&&(0,a.jsx)("button",{onClick:()=>N("ACCEPT"),className:"px-4 py-2 rounded bg-green-600 text-white hover:bg-green-700 transition focus:outline-none focus:ring focus:ring-green-300",children:"Accept"})]}),(0,a.jsxs)("div",{className:"mt-10",children:[(0,a.jsx)("h2",{className:"text-lg font-semibold mb-2",children:"Order Chat"}),(0,a.jsxs)("div",{ref:y,className:"border rounded h-64 overflow-y-auto bg-white p-3 mb-2",children:[0===h.length&&(0,a.jsx)("div",{className:"text-gray-400",children:"No messages yet."}),h.map((e,s)=>(0,a.jsx)("div",{className:"mb-2 flex ".concat(e.sender_id===b?"justify-end":"justify-start"),children:(0,a.jsxs)("div",{className:"px-3 py-2 rounded ".concat(e.sender_id===b?"bg-blue-100":"bg-gray-100"),children:[(0,a.jsx)("span",{className:"text-sm",children:e.content}),(0,a.jsx)("div",{className:"text-xs text-gray-400 mt-1",children:new Date(e.created_at).toLocaleTimeString()})]})},e.id||s))]}),(0,a.jsxs)("form",{onSubmit:j,className:"flex gap-2",children:[(0,a.jsx)("input",{className:"border rounded w-full p-2 focus:outline-none focus:ring focus:ring-blue-300",placeholder:"Type a message…",value:f,onChange:e=>p(e.target.value)}),(0,a.jsx)("button",{className:"px-4 py-2 rounded bg-black text-white hover:bg-gray-800 transition focus:outline-none focus:ring focus:ring-blue-300",type:"submit",children:"Send"})]})]}),"COMPLETED"===t.status&&!m&&(0,a.jsxs)("div",{className:"mt-8 border-t pt-6",children:[(0,a.jsx)("h2",{className:"text-lg font-semibold mb-2",children:"Leave a Review"}),(0,a.jsxs)("div",{className:"flex items-center gap-2 mb-2",children:[(0,a.jsx)("span",{children:"Rating:"}),(0,a.jsx)("input",{type:"number",min:1,max:5,value:u.rating,onChange:e=>d(s=>({...s,rating:Number(e.target.value)})),className:"border rounded w-16 p-1 focus:outline-none focus:ring focus:ring-blue-300"}),(0,a.jsx)("span",{className:"text-yellow-600",children:"★".repeat(u.rating)})]}),(0,a.jsx)("textarea",{className:"border w-full p-2 mb-2 focus:outline-none focus:ring focus:ring-blue-300",rows:3,placeholder:"Write your review...",value:u.comment,onChange:e=>d(s=>({...s,comment:e.target.value}))}),(0,a.jsx)("button",{onClick:w,className:"px-4 py-2 rounded bg-black text-white hover:bg-gray-800 transition focus:outline-none focus:ring focus:ring-blue-300",children:"Submit Review"})]}),"COMPLETED"===t.status&&m&&(0,a.jsx)("div",{className:"mt-8 text-green-600",children:"You have already reviewed this order."})]}):(0,a.jsx)("div",{className:"flex justify-center items-center py-10",children:(0,a.jsxs)("svg",{className:"animate-spin h-8 w-8 text-blue-600",viewBox:"0 0 24 24",children:[(0,a.jsx)("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4",fill:"none"}),(0,a.jsx)("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8v8z"})]})})}}},e=>{e.O(0,[2663,8441,1255,7358],()=>e(e.s=1916)),_N_E=e.O()}]);